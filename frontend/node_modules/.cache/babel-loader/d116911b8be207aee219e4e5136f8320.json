{"ast":null,"code":"!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t(require(\"prop-types\"), require(\"react\"), require(\"react-dom\")) : \"function\" == typeof define && define.amd ? define([\"prop-types\", \"react\", \"react-dom\"], t) : e.AvatarEditor = t(e.PropTypes, e.React, e.ReactDOM);\n}(this, function (e, t, o) {\n  \"use strict\";\n\n  function a(e, t) {\n    return new Promise(function (o, a) {\n      var n,\n          i = new Image();\n      i.onload = function () {\n        return o(i);\n      }, i.onerror = a, !1 == (null !== (n = e) && !!n.match(/^\\s*data:([a-z]+\\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\\-._~:@/?%\\s]*\\s*$/i)) && t && (i.crossOrigin = t), i.src = e;\n    });\n  }\n\n  e = e && e.hasOwnProperty(\"default\") ? e.default : e, t = t && t.hasOwnProperty(\"default\") ? t.default : t, o = o && o.hasOwnProperty(\"default\") ? o.default : o;\n\n  var n = function n(e, t) {\n    if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n  },\n      i = function () {\n    function e(e, t) {\n      for (var o = 0; o < t.length; o++) {\n        var a = t[o];\n        a.enumerable = a.enumerable || !1, a.configurable = !0, \"value\" in a && (a.writable = !0), Object.defineProperty(e, a.key, a);\n      }\n    }\n\n    return function (t, o, a) {\n      return o && e(t.prototype, o), a && e(t, a), t;\n    };\n  }(),\n      r = Object.assign || function (e) {\n    for (var t = 1; t < arguments.length; t++) {\n      var o = arguments[t];\n\n      for (var a in o) {\n        Object.prototype.hasOwnProperty.call(o, a) && (e[a] = o[a]);\n      }\n    }\n\n    return e;\n  },\n      s = function s(e, t) {\n    if (!e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    return !t || \"object\" != typeof t && \"function\" != typeof t ? e : t;\n  },\n      h = function () {\n    return function (e, t) {\n      if (Array.isArray(e)) return e;\n      if (Symbol.iterator in Object(e)) return function (e, t) {\n        var o = [],\n            a = !0,\n            n = !1,\n            i = void 0;\n\n        try {\n          for (var r, s = e[Symbol.iterator](); !(a = (r = s.next()).done) && (o.push(r.value), !t || o.length !== t); a = !0) {\n            ;\n          }\n        } catch (e) {\n          n = !0, i = e;\n        } finally {\n          try {\n            !a && s.return && s.return();\n          } finally {\n            if (n) throw i;\n          }\n        }\n\n        return o;\n      }(e, t);\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    };\n  }(),\n      u = !(\"undefined\" == typeof window || \"undefined\" == typeof navigator || !(\"ontouchstart\" in window || navigator.msMaxTouchPoints > 0)),\n      c = \"undefined\" != typeof File,\n      d = {\n    touch: {\n      react: {\n        down: \"onTouchStart\",\n        mouseDown: \"onMouseDown\",\n        drag: \"onTouchMove\",\n        move: \"onTouchMove\",\n        mouseMove: \"onMouseMove\",\n        up: \"onTouchEnd\",\n        mouseUp: \"onMouseUp\"\n      },\n      native: {\n        down: \"touchstart\",\n        mouseDown: \"mousedown\",\n        drag: \"touchmove\",\n        move: \"touchmove\",\n        mouseMove: \"mousemove\",\n        up: \"touchend\",\n        mouseUp: \"mouseup\"\n      }\n    },\n    desktop: {\n      react: {\n        down: \"onMouseDown\",\n        drag: \"onDragOver\",\n        move: \"onMouseMove\",\n        up: \"onMouseUp\"\n      },\n      native: {\n        down: \"mousedown\",\n        drag: \"dragStart\",\n        move: \"mousemove\",\n        up: \"mouseup\"\n      }\n    }\n  },\n      p = u ? d.touch : d.desktop,\n      l = \"undefined\" != typeof window && window.devicePixelRatio ? window.devicePixelRatio : 1,\n      g = function (e) {\n    function d() {\n      var e, t, o;\n      n(this, d);\n\n      for (var a = arguments.length, i = Array(a), h = 0; h < a; h++) {\n        i[h] = arguments[h];\n      }\n\n      return t = o = s(this, (e = d.__proto__ || Object.getPrototypeOf(d)).call.apply(e, [this].concat(i))), o.state = {\n        drag: !1,\n        my: null,\n        mx: null,\n        image: {\n          x: .5,\n          y: .5\n        }\n      }, o.handleImageReady = function (e) {\n        var t = o.getInitialSize(e.width, e.height);\n        t.resource = e, t.x = .5, t.y = .5, o.setState({\n          drag: !1,\n          image: t\n        }, o.props.onImageReady), o.props.onLoadSuccess(t);\n      }, o.clearImage = function () {\n        var e = o.canvas;\n        e.getContext(\"2d\").clearRect(0, 0, e.width, e.height);\n      }, o.handleMouseDown = function (e) {\n        (e = e || window.event).preventDefault(), o.setState({\n          drag: !0,\n          mx: null,\n          my: null\n        });\n      }, o.handleMouseUp = function () {\n        o.state.drag && (o.setState({\n          drag: !1\n        }), o.props.onMouseUp());\n      }, o.handleMouseMove = function (e) {\n        if (e = e || window.event, !1 !== o.state.drag) {\n          var t = e.targetTouches ? e.targetTouches[0].pageX : e.clientX,\n              a = e.targetTouches ? e.targetTouches[0].pageY : e.clientY,\n              n = {\n            mx: t,\n            my: a\n          },\n              i = o.props.rotate;\n\n          if (i = (i %= 360) < 0 ? i + 360 : i, o.state.mx && o.state.my) {\n            var s = o.state.mx - t,\n                h = o.state.my - a,\n                u = o.state.image.width * o.props.scale,\n                c = o.state.image.height * o.props.scale,\n                d = o.getCroppingRect(),\n                p = d.x,\n                l = d.y;\n            p *= u, l *= c;\n\n            var g = function g(e) {\n              return e * (Math.PI / 180);\n            },\n                m = Math.cos(g(i)),\n                v = Math.sin(g(i)),\n                f = l + -s * v + h * m,\n                y = {\n              x: (p + s * m + h * v) / u + 1 / o.props.scale * o.getXScale() / 2,\n              y: f / c + 1 / o.props.scale * o.getYScale() / 2\n            };\n\n            o.props.onPositionChange(y), n.image = r({}, o.state.image, y);\n          }\n\n          o.setState(n), o.props.onMouseMove(e);\n        }\n      }, o.setCanvas = function (e) {\n        o.canvas = e;\n      }, s(o, t);\n    }\n\n    return function (e, t) {\n      if (\"function\" != typeof t && null !== t) throw new TypeError(\"Super expression must either be null or a function, not \" + typeof t);\n      e.prototype = Object.create(t && t.prototype, {\n        constructor: {\n          value: e,\n          enumerable: !1,\n          writable: !0,\n          configurable: !0\n        }\n      }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t);\n    }(d, t.Component), i(d, [{\n      key: \"componentDidMount\",\n      value: function value() {\n        var e = o.findDOMNode(this.canvas).getContext(\"2d\");\n\n        if (this.props.image && this.loadImage(this.props.image), this.paint(e), document) {\n          var t = p.native;\n          document.addEventListener(t.move, this.handleMouseMove, !1), document.addEventListener(t.up, this.handleMouseUp, !1), u && (document.addEventListener(t.mouseMove, this.handleMouseMove, !1), document.addEventListener(t.mouseUp, this.handleMouseUp, !1));\n        }\n      }\n    }, {\n      key: \"componentWillReceiveProps\",\n      value: function value(e) {\n        e.image && this.props.image !== e.image || this.props.width !== e.width || this.props.height !== e.height ? this.loadImage(e.image) : e.image || this.clearImage();\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function value(e, t) {\n        var a = o.findDOMNode(this.canvas),\n            n = a.getContext(\"2d\");\n        n.clearRect(0, 0, a.width, a.height), this.paint(n), this.paintImage(n, this.state.image, this.props.border), e.image === this.props.image && e.width === this.props.width && e.height === this.props.height && e.position === this.props.position && e.scale === this.props.scale && e.rotate === this.props.rotate && t.my === this.state.my && t.mx === this.state.mx && t.image.x === this.state.image.x && t.image.y === this.state.image.y || this.props.onImageChange();\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function value() {\n        if (document) {\n          var e = p.native;\n          document.removeEventListener(e.move, this.handleMouseMove, !1), document.removeEventListener(e.up, this.handleMouseUp, !1), u && (document.removeEventListener(e.mouseMove, this.handleMouseMove, !1), document.removeEventListener(e.mouseUp, this.handleMouseUp, !1));\n        }\n      }\n    }, {\n      key: \"isVertical\",\n      value: function value() {\n        return this.props.rotate % 180 != 0;\n      }\n    }, {\n      key: \"getBorders\",\n      value: function value() {\n        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : this.props.border;\n        return Array.isArray(e) ? e : [e, e];\n      }\n    }, {\n      key: \"getDimensions\",\n      value: function value() {\n        var e = this.props,\n            t = e.width,\n            o = e.height,\n            a = e.rotate,\n            n = e.border,\n            i = {},\n            r = this.getBorders(n),\n            s = h(r, 2),\n            u = s[0],\n            c = s[1],\n            d = t,\n            p = o;\n        return this.isVertical() ? (i.width = p, i.height = d) : (i.width = d, i.height = p), i.width += 2 * u, i.height += 2 * c, {\n          canvas: i,\n          rotate: a,\n          width: t,\n          height: o,\n          border: n\n        };\n      }\n    }, {\n      key: \"getImage\",\n      value: function value() {\n        var e = this.getCroppingRect(),\n            t = this.state.image;\n        e.x *= t.resource.width, e.y *= t.resource.height, e.width *= t.resource.width, e.height *= t.resource.height;\n        var o = document.createElement(\"canvas\");\n        this.isVertical() ? (o.width = e.height, o.height = e.width) : (o.width = e.width, o.height = e.height);\n        var a = o.getContext(\"2d\");\n        return a.translate(o.width / 2, o.height / 2), a.rotate(this.props.rotate * Math.PI / 180), a.translate(-o.width / 2, -o.height / 2), this.isVertical() && a.translate((o.width - o.height) / 2, (o.height - o.width) / 2), a.drawImage(t.resource, -e.x, -e.y), o;\n      }\n    }, {\n      key: \"getImageScaledToCanvas\",\n      value: function value() {\n        var e = this.getDimensions(),\n            t = e.width,\n            o = e.height,\n            a = document.createElement(\"canvas\");\n        return this.isVertical() ? (a.width = o, a.height = t) : (a.width = t, a.height = o), this.paintImage(a.getContext(\"2d\"), this.state.image, 0, 1), a;\n      }\n    }, {\n      key: \"getXScale\",\n      value: function value() {\n        var e = this.props.width / this.props.height,\n            t = this.state.image.width / this.state.image.height;\n        return Math.min(1, e / t);\n      }\n    }, {\n      key: \"getYScale\",\n      value: function value() {\n        var e = this.props.height / this.props.width,\n            t = this.state.image.height / this.state.image.width;\n        return Math.min(1, e / t);\n      }\n    }, {\n      key: \"getCroppingRect\",\n      value: function value() {\n        var e = this.props.position || {\n          x: this.state.image.x,\n          y: this.state.image.y\n        },\n            t = 1 / this.props.scale * this.getXScale(),\n            o = 1 / this.props.scale * this.getYScale(),\n            a = {\n          x: e.x - t / 2,\n          y: e.y - o / 2,\n          width: t,\n          height: o\n        },\n            n = 0,\n            i = 1 - a.width,\n            s = 0,\n            h = 1 - a.height;\n        return (this.props.disableBoundaryChecks || t > 1 || o > 1) && (n = -a.width, i = 1, s = -a.height, h = 1), r({}, a, {\n          x: Math.max(n, Math.min(a.x, i)),\n          y: Math.max(s, Math.min(a.y, h))\n        });\n      }\n    }, {\n      key: \"loadImage\",\n      value: function value(e) {\n        var t;\n        c && e instanceof File ? (t = e, new Promise(function (e, o) {\n          var n = new FileReader();\n          n.onload = function (t) {\n            try {\n              var n = a(t.target.result);\n              e(n);\n            } catch (t) {\n              o(t);\n            }\n          }, n.readAsDataURL(t);\n        })).then(this.handleImageReady).catch(this.props.onLoadFailure) : \"string\" == typeof e && a(e, this.props.crossOrigin).then(this.handleImageReady).catch(this.props.onLoadFailure);\n      }\n    }, {\n      key: \"getInitialSize\",\n      value: function value(e, t) {\n        var o = void 0,\n            a = void 0,\n            n = this.getDimensions();\n        return n.height / n.width > t / e ? a = e * ((o = this.getDimensions().height) / t) : o = t * ((a = this.getDimensions().width) / e), {\n          height: o,\n          width: a\n        };\n      }\n    }, {\n      key: \"paintImage\",\n      value: function value(e, t, o) {\n        var a = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : l;\n\n        if (t.resource) {\n          var n = this.calculatePosition(t, o);\n          e.save(), e.translate(e.canvas.width / 2, e.canvas.height / 2), e.rotate(this.props.rotate * Math.PI / 180), e.translate(-e.canvas.width / 2, -e.canvas.height / 2), this.isVertical() && e.translate((e.canvas.width - e.canvas.height) / 2, (e.canvas.height - e.canvas.width) / 2), e.scale(a, a), e.globalCompositeOperation = \"destination-over\", e.drawImage(t.resource, n.x, n.y, n.width, n.height), e.restore();\n        }\n      }\n    }, {\n      key: \"calculatePosition\",\n      value: function value(e, t) {\n        e = e || this.state.image;\n        var o = this.getBorders(t),\n            a = h(o, 2),\n            n = a[0],\n            i = a[1],\n            r = this.getCroppingRect(),\n            s = e.width * this.props.scale,\n            u = e.height * this.props.scale,\n            c = -r.x * s,\n            d = -r.y * u;\n        return this.isVertical() ? (c += i, d += n) : (c += n, d += i), {\n          x: c,\n          y: d,\n          height: u,\n          width: s\n        };\n      }\n    }, {\n      key: \"paint\",\n      value: function value(e) {\n        e.save(), e.scale(l, l), e.translate(0, 0), e.fillStyle = \"rgba(\" + this.props.color.slice(0, 4).join(\",\") + \")\";\n        var t = this.props.borderRadius,\n            o = this.getDimensions(),\n            a = this.getBorders(o.border),\n            n = h(a, 2),\n            i = n[0],\n            r = n[1],\n            s = o.canvas.height,\n            u = o.canvas.width;\n        t = Math.max(t, 0), t = Math.min(t, u / 2 - i, s / 2 - r), e.beginPath(), function (e, t, o, a, n, i) {\n          if (0 === i) e.rect(t, o, a, n);else {\n            var r = a - i,\n                s = n - i;\n            e.translate(t, o), e.arc(i, i, i, Math.PI, 1.5 * Math.PI), e.lineTo(r, 0), e.arc(r, i, i, 1.5 * Math.PI, 2 * Math.PI), e.lineTo(a, s), e.arc(r, s, i, 2 * Math.PI, .5 * Math.PI), e.lineTo(i, n), e.arc(i, s, i, .5 * Math.PI, Math.PI), e.translate(-t, -o);\n          }\n        }(e, i, r, u - 2 * i, s - 2 * r, t), e.rect(u, 0, -u, s), e.fill(\"evenodd\"), e.restore();\n      }\n    }, {\n      key: \"render\",\n      value: function value() {\n        var e = this.props,\n            o = (e.scale, e.rotate, e.image, e.border, e.borderRadius, e.width, e.height, e.position, e.color, e.style),\n            a = (e.crossOrigin, e.onLoadFailure, e.onLoadSuccess, e.onImageReady, e.onImageChange, e.onMouseUp, e.onMouseMove, e.onPositionChange, e.disableBoundaryChecks, function (e, t) {\n          var o = {};\n\n          for (var a in e) {\n            t.indexOf(a) >= 0 || Object.prototype.hasOwnProperty.call(e, a) && (o[a] = e[a]);\n          }\n\n          return o;\n        }(e, [\"scale\", \"rotate\", \"image\", \"border\", \"borderRadius\", \"width\", \"height\", \"position\", \"color\", \"style\", \"crossOrigin\", \"onLoadFailure\", \"onLoadSuccess\", \"onImageReady\", \"onImageChange\", \"onMouseUp\", \"onMouseMove\", \"onPositionChange\", \"disableBoundaryChecks\"])),\n            n = this.getDimensions(),\n            i = {\n          width: n.canvas.width,\n          height: n.canvas.height,\n          cursor: this.state.drag ? \"grabbing\" : \"grab\",\n          touchAction: \"none\"\n        },\n            s = {\n          width: n.canvas.width * l,\n          height: n.canvas.height * l,\n          style: r({}, i, o)\n        };\n        return s[p.react.down] = this.handleMouseDown, u && (s[p.react.mouseDown] = this.handleMouseDown), t.createElement(\"canvas\", r({\n          ref: this.setCanvas\n        }, s, a));\n      }\n    }]), d;\n  }();\n\n  return g.propTypes = {\n    scale: e.number,\n    rotate: e.number,\n    image: e.oneOfType([e.string].concat(function (e) {\n      if (Array.isArray(e)) {\n        for (var t = 0, o = Array(e.length); t < e.length; t++) {\n          o[t] = e[t];\n        }\n\n        return o;\n      }\n\n      return Array.from(e);\n    }(c ? [e.instanceOf(File)] : []))),\n    border: e.oneOfType([e.number, e.arrayOf(e.number)]),\n    borderRadius: e.number,\n    width: e.number,\n    height: e.number,\n    position: e.shape({\n      x: e.number,\n      y: e.number\n    }),\n    color: e.arrayOf(e.number),\n    style: e.object,\n    crossOrigin: e.oneOf([\"\", \"anonymous\", \"use-credentials\"]),\n    className: e.string,\n    onLoadFailure: e.func,\n    onLoadSuccess: e.func,\n    onImageReady: e.func,\n    onImageChange: e.func,\n    onMouseUp: e.func,\n    onMouseMove: e.func,\n    onPositionChange: e.func,\n    disableBoundaryChecks: e.bool\n  }, g.defaultProps = {\n    disableBoundaryChecks: !1,\n    scale: 1,\n    rotate: 0,\n    border: 25,\n    borderRadius: 0,\n    width: 200,\n    height: 200,\n    color: [0, 0, 0, .5],\n    style: {},\n    className: \"\",\n    onLoadFailure: function onLoadFailure() {},\n    onLoadSuccess: function onLoadSuccess() {},\n    onImageReady: function onImageReady() {},\n    onImageChange: function onImageChange() {},\n    onMouseUp: function onMouseUp() {},\n    onMouseMove: function onMouseMove() {},\n    onPositionChange: function onPositionChange() {}\n  }, g;\n});","map":null,"metadata":{},"sourceType":"script"}